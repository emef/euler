(defparameter *max-n* 10000)

(let ((divisor-table (make-hash-table)))
  (dotimes (i (/ *max-n* 2))
    (loop for j from i to (/ *max-n* 2) do
      (let ((result (* i j)))
        (pushnew i (gethash result divisor-table))
        (pushnew j (gethash result divisor-table)))))
  (defun divisors (n)
    (gethash n divisor-table)))

(defun d-sum (n)
  (reduce #'+ (divisors n)))

